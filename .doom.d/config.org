#+TITLE: Doom Emacs Config
#+AUTHOR: realsontaran
#+STARTUP: showeverything
#+PROPERTY: header-args :tangle config.el

* My Doom Emacs Config
** User
#+begin_src emacs-lisp
(setq user-full-name "realsontaran"
      user-mail-address "therealsontaran@protonmailcom")
#+end_src

** Font, Theme and Splash Screen
Setting up nice user interface.

#+begin_src emacs-lisp
(setq doom-font (font-spec :family "JetBrains Mono" :size 14)
      doom-big-font (font-spec :family "JetBrains Mono" :size 20)
      doom-variable-pitch-font (font-spec :family "Overpass" :size 20)
      doom-serif-font (font-spec :family "IBM Plex Mono" :weight 'light))

(setq display-line-numbers-type t)
(setq fancy-splash-image "~/.doom.d/orangutan.png")
(setq doom-theme 'doom-dracula)
(custom-set-faces!
  '(doom-modeline-buffer-modified :foreground "orange"))

;; Add some transparency
;; (set-frame-parameter (selected-frame) 'alpha '(90 90))
;; (add-to-list 'default-frame-alist '(alpha 90 90))
(windmove-default-keybindings)
#+end_src

** Variable Setting
Setting some values.
#+begin_src emacs-lisp
(setq-default
 delete-by-moving-to-trash t
 window-combination-resize t)

;; (setq doom-fallback-buffer-name "► Doom"
;;       +doom-dashboard-name "► Doom")

;; Mode-line
(display-time-mode t)
(unless (equal "Battery status not available"
               (battery))
  (display-battery-mode 1))
(setq auth-sources '("~/.authinfo"))
(setq save-interprogram-paste-before-kill nil)
#+end_src
** Some Functions
#+begin_src emacs-lisp
(map! :ne "M-/" #'comment-or-uncomment-region)
#+end_src
** Which-Key Pop-Up
#+begin_src emacs-lisp
(setq which-key-idle-delay 0.5)
(setq which-key-allow-multiple-replacements t)
(after! which-key
  (pushnew!
   which-key-replacement-alist
   '(("" . "\\`+?evil[-:]?\\(?:a-\\)?\\(.*\\)") . (nil . "◂\\1"))
   '(("\\`g s" . "\\`evilem--?motion-\\(.*\\)") . (nil . "◃\\1"))
   ))
#+end_src
** ORG-MODE
Setting todo keywords, org-agenda directories and some keymapping for funcional workspace.
#+begin_src emacs-lisp
(after! org
  (setq org-directory "~/Dropbox/org/")
  (setq org-log-done 'time)
  (setq org-agenda-files (directory-files-recursively "~/Dropbox/org/" "\\.org$"))
  (setq org-todo-keywords
        '((sequence "TODO" "|" "DONE" "CNCL")
          (sequence "[ ]" "[-]" "|" "[X]")
          (sequence "LECTURE(l)" "|")
          (sequence "HOMEWORK" "PROJ" "TASK" "|" "DONE")
          (sequence "PLAY" "READ" "WATCH" "ONIT" "|" "DONE")
          ))
  (setq org-todo-keyword-faces
        '(("TODO" . "orange")
          ("HOMWRK" . "orange")
          ("DONE" . "green")
          ("CNCL" . (:foreground "red" :weight bold))
          ("LECTURE" . "purple")
          ("PLAY" . "pink")
          ("READ" . "pink")
          ("WATCH" . "blue")
          ("ONIT" . "yellow")
          ("[ ]" . "orange")
          ("[-]" . "yellow")
          ("[X]" . "green")))

  (add-hook 'org-mode-hook (lambda () (prettify-symbols-mode)))
  (setq org-ellipsis " ↴ "
        org-tags-column -80
        org-log-done 'time
        org-fancy-priorities-list '("⚡" "⬆" "⬇" "☕"))
  (map!
   :map 'org-mode-map
   :localleader
   :ni "U" #'org-latex-preview)

  (map!
   :map 'org-mode-map
   :localleader
   :ni "v" #'org-insert-clipboard-image))

;; Create new Org buffer.
(evil-define-command evil-buffer-org-new (count file)
  "Creates a new ORG buffer replacing the current window, optionally
   editing a certain FILE"
  :repeat nil
  (interactive "P<f>")
  (if file
      (evil-edit file)
    (let ((buffer (generate-new-buffer "*new org*")))
      (set-window-buffer nil buffer)
      (with-current-buffer buffer
        (org-mode)))))
(map! :leader
      (:prefix "b"
       :desc "New empty ORG buffer" "o" #'evil-buffer-org-new))
#+end_src

Function that inserts image to org file from clipboard.

#+begin_src emacs-lisp
(defun org-insert-clipboard-image ()
  "Insert screenshot to org file"
  (interactive)
  (make-directory "./resources/" :parents)
  (let ((filename (concat (format-time-string "%Y_%m_%d_%H%M%S") ".png")))
    (shell-command (concat "cd resources && " "xclip -selection clipboard -t image/png -o > " filename))
    (insert (concat "[[./resources/" filename "]]"))))
#+end_src
** Org-Capture
Capture my notes.
#+begin_src emacs-lisp
(setq +org-capture-notes-file "~/Dropbox/org/capture/notes.org"
      +org-capture-changelog-file "~/Dropbox/org/capture/changelog.org"
      +org-capture-todo-file "~/Dropbox/org/capture/todo.org"
      +org-capture-projects-file "~/Dropbox/org/capture/projects.org"
      +org-capture-journal-file "~/Dropbox/org/capture/journal.org")

(use-package! doct
  :commands (doct))

(after! org-capture
  (setq +org-capture-uni-units (condition-case nil
                                   (split-string (f-read-text "~/.org/.uni-units"))
                                 (error nil)))
  (defun +doct-icon-declaration-to-icon (declaration)
    "Convert :icon declaration to icon"
    (let ((name (pop declaration))
          (set  (intern (concat "all-the-icons-" (plist-get declaration :set))))
          (face (intern (concat "all-the-icons-" (plist-get declaration :color))))
          (v-adjust (or (plist-get declaration :v-adjust) 0.01)))
      (apply set `(,name :face ,face :v-adjust ,v-adjust))))

  (defun +doct-iconify-capture-templates (groups)
    "Add declaration's :icon to each template group in GROUPS."
    (let ((templates (doct-flatten-lists-in groups)))
      (setq doct-templates (mapcar (lambda (template)
                                     (when-let* ((props (nthcdr (if (= (length template) 4) 2 5) template))
                                                 (spec (plist-get (plist-get props :doct) :icon)))
                                       (setf (nth 1 template) (concat (+doct-icon-declaration-to-icon spec)
                                                                      "\t"
                                                                      (nth 1 template))))
                                     template)
                                   templates))))
  (setq doct-after-conversion-functions '(+doct-iconify-capture-templates))
  (defun set-org-capture-templates ()
    (setq org-capture-templates
          (doct `(("Personal todo" :keys "t"
                   :icon ("checklist" :set "octicon" :color "green")
                   :file +org-capture-todo-file
                   :prepend t
                   :headline "Inbox"
                   :type entry
                   :template ("* TODO %?"
                              "%i %a")
                   )
                  ("Personal note" :keys "n"
                   :icon ("sticky-note-o" :set "faicon" :color "green")
                   :file +org-capture-todo-file
                   :prepend t
                   :headline "Inbox"
                   :type entry
                   :template ("* %?"
                              "%i %a")
                   )
                  ("University" :keys "u"
                   :icon ("graduation-cap" :set "faicon" :color "purple")
                   :file +org-capture-todo-file
                   :headline "University"
                   :unit-prompt ,(format "%%^{Unit|%s}" (string-join +org-capture-uni-units "|"))
                   :prepend t
                   :type entry
                   :children (("Test" :keys "t"
                               :icon ("timer" :set "material" :color "red")
                               :template ("* TODO [#C] %{unit-prompt} %? :uni:tests:"
                                          "SCHEDULED: %^{Test date:}T"
                                          "%i %a"))
                              ("Assignment" :keys "a"
                               :icon ("library_books" :set "material" :color "orange")
                               :template ("* TODO [#B] %{unit-prompt} %? :uni:assignments:"
                                          "DEADLINE: %^{Due date:}T"
                                          "%i %a"))
                              ("Lecture" :keys "l"
                               :icon ("keynote" :set "fileicon" :color "orange")
                               :template ("* TODO [#C] %{unit-prompt} %? :uni:lecture:"
                                          "%i %a"))
                              ("Miscellaneous task" :keys "u"
                               :icon ("list" :set "faicon" :color "yellow")
                               :template ("* TODO [#D] %{unit-prompt} %? :uni:"
                                          "%i %a"))))
                  ("Interesting" :keys "i"
                   :icon ("eye" :set "faicon" :color "lcyan")
                   :file +org-capture-todo-file
                   :prepend t
                   :headline "Interesting"
                   :type entry
                   :template ("* [ ] %{desc}%? :%{i-type}:"
                              "%i %a")
                   :children (("Webpage" :keys "w"
                               :icon ("globe" :set "faicon" :color "green")
                               :desc "%(org-cliplink-capture) "
                               :i-type "read:web"
                               )
                              ("Article" :keys "a"
                               :icon ("file-text" :set "octicon" :color "yellow")
                               :desc ""
                               :i-type "read:reaserch"
                               )
                              ("Information" :keys "i"
                               :icon ("info-circle" :set "faicon" :color "blue")
                               :desc ""
                               :i-type "read:info"
                               )
                              ("Idea" :keys "I"
                               :icon ("bubble_chart" :set "material" :color "silver")
                               :desc ""
                               :i-type "idea"
                               )))
                  ("Tasks" :keys "k"
                   :icon ("inbox" :set "octicon" :color "yellow")
                   :file +org-capture-todo-file
                   :prepend t
                   :headline "Tasks"
                   :type entry
                   :template ("* TODO %? %^G%{extra}"
                              "%i %a")
                   :children (("General Task" :keys "k"
                               :icon ("inbox" :set "octicon" :color "yellow")
                               :extra ""
                               )
                              ("Task with deadline" :keys "d"
                               :icon ("timer" :set "material" :color "orange" :v-adjust -0.1)
                               :extra "\nDEADLINE: %^{Deadline:}t"
                               )
                              ("Scheduled Task" :keys "s"
                               :icon ("calendar" :set "octicon" :color "orange")
                               :extra "\nSCHEDULED: %^{Start time:}t"
                               )
                              ))
                  ("Project" :keys "p"
                   :icon ("repo" :set "octicon" :color "silver")
                   :prepend t
                   :type entry
                   :headline "Inbox"
                   :template ("* %{time-or-todo} %?"
                              "%i"
                              "%a")
                   :file ""
                   :custom (:time-or-todo "")
                   :children (("Project-local todo" :keys "t"
                               :icon ("checklist" :set "octicon" :color "green")
                               :time-or-todo "TODO"
                               :file +org-capture-project-todo-file)
                              ("Project-local note" :keys "n"
                               :icon ("sticky-note" :set "faicon" :color "yellow")
                               :time-or-todo "%U"
                               :file +org-capture-project-notes-file)
                              ("Project-local changelog" :keys "c"
                               :icon ("list" :set "faicon" :color "blue")
                               :time-or-todo "%U"
                               :heading "Unreleased"
                               :file +org-capture-project-changelog-file))
                   )
                  ("\tCentralised project templates"
                   :keys "o"
                   :type entry
                   :prepend t
                   :template ("* %{time-or-todo} %?"
                              "%i"
                              "%a")
                   :children (("Project todo"
                               :keys "t"
                               :prepend nil
                               :time-or-todo "TODO"
                               :heading "Tasks"
                               :file +org-capture-central-project-todo-file)
                              ("Project note"
                               :keys "n"
                               :time-or-todo "%U"
                               :heading "Notes"
                               :file +org-capture-central-project-notes-file)
                              ("Project changelog"
                               :keys "c"
                               :time-or-todo "%U"
                               :heading "Unreleased"
                               :file +org-capture-central-project-changelog-file))
                   )))))

  (set-org-capture-templates)
  (unless (display-graphic-p)
    (add-hook 'server-after-make-frame-hook
              (defun org-capture-reinitialise-hook ()
                (when (display-graphic-p)
                  (set-org-capture-templates)
                  (remove-hook 'server-after-make-frame-hook
                               #'org-capture-reinitialise-hook ))))))
#+end_src

** Org-Super-Agenda
Org-agenda but more fancy.
#+begin_src emacs-lisp
(setq org-agenda-scheduled-leaders '("" ""))
(use-package! org-super-agenda
  :after org-agenda
  :init
  (setq org-super-agenda-groups '((:todo "DONE" :log t :order 0)
                                  (:name "DO IT NOW" :priority "A" :order 1)
                                  (:name "Lecture" :tag "lecture" :order 2)
                                  (:name "Due Today" :order 3 :deadline today)
                                  (:name "Routines" :tag "routine" :order 4)
                                  (:habit t :order 5)
                                  (:priority<= "B" :order 10)
                                  (:name "Fun Activities" :tag "Fun")
                                  (:auto-parent t :order 20)))
  :config
  (org-super-agenda-mode))
#+end_src
** Dired

#+begin_src emacs-lisp
(use-package! dired
  :commands (dired dired-jump)
  :bind (("C-x C-j" . dired-jump))
  :config
  (evil-collection-define-key 'normal 'dired-mode-map
    "h" 'dired-up-directory
    "l" 'dired-find-file))
#+end_src
** Window Keybinding
I wasn't comfortable with splitting windows with Ctrl commands.
#+begin_src emacs-lisp
(map! :leader :desc "find-file-other-window" "d" #'find-file-other-window)
#+end_src
** Clang Support
Giving my clang formatter file to emacs and setting a keybinding.
#+begin_src emacs-lisp
                                        ;(load "/usr/share/clang/clang-format.el")
                                        ;(global-set-key [C-M-tab] 'clang-format-region)
#+end_src

** Flutter and Dart Setup
#+begin_src emacs-lisp
(after! lsp-dart
  (setq lsp-dart-sdk-dir "/home/penguin/Documents/flutter/bin/cache/dart-sdk/")
  (setq flutter-sdk-path "/home/penguin/Documents/flutter/")
  (setq lsp-dart-flutter-sdk-dir "/home/penguin/Documents/flutter/")
  (setq dart-format-on-save t))
#+end_src

** Latex Config
#+begin_src emacs-lisp
(setq TeX-auto-untabify 't)
#+end_src
** Org-gamedb
#+begin_src emacs-lisp
(use-package! org-gamedb
  :defer t
  :config
  (setq org-gamedb-api-key "224983015bb67d4c49074fe795150b9be8addf04"))
#+end_src
